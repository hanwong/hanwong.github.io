<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset="utf-8">
    
    <title>VueJS | Vuex Unit Test (1) | Woong&#39;s blog.</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Axios를 활용해서 API 호출을 담당하는 Action들의 Unit Test에 대해 다루는 글입니다.">
<meta property="og:type" content="article">
<meta property="og:title" content="VueJS | Vuex Unit Test (1)">
<meta property="og:url" content="http://hanwong.github.io/2017/09/23/vuex-actions-unit-test/index.html">
<meta property="og:site_name" content="Woong's blog.">
<meta property="og:description" content="Axios를 활용해서 API 호출을 담당하는 Action들의 Unit Test에 대해 다루는 글입니다.">
<meta property="og:image" content="http://hanwong.github.io/assets/vue.png">
<meta property="og:updated_time" content="2017-09-24T13:14:25.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="VueJS | Vuex Unit Test (1)">
<meta name="twitter:description" content="Axios를 활용해서 API 호출을 담당하는 Action들의 Unit Test에 대해 다루는 글입니다.">
<meta name="twitter:image" content="http://hanwong.github.io/assets/vue.png">
    

    

    
        <link rel="icon" href="/css/images/favicon-32.png" />
    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


    <link href='//spoqa.github.io/spoqa-han-sans/css/SpoqaHanSans-kr.css' rel='stylesheet' type='text/css'>
</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">Woong&#39;s blog.</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/profile.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/profile.png" />
            <h2 id="name">Kim Han Woong</h2>
            <h3 id="title">Front-end Developer</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Korea</span>
            <a id="follow" target="_blank" href="https://github.com/hanwong/">FOLLOW</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                11
                <span>posts</span>
            </div>
            <div class="article-info-block">
                32
                <span>tags</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="https://github.com/hanwong" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://www.instagram.com/hanationbear" target="_blank" title="instagram" class=tooltip>
                            <i class="fa fa-instagram"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://www.facebook.com/hanwong85" target="_blank" title="facebook" class=tooltip>
                            <i class="fa fa-facebook"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://twitter.com/HanW000ng" target="_blank" title="twitter" class=tooltip>
                            <i class="fa fa-twitter"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-vuex-actions-unit-test" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            
	
		<img src="/assets/unit-test.png" class="article-banner" />
	



        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            VueJS | Vuex Unit Test (1)
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/09/23/vuex-actions-unit-test/">
            <time datetime="2017-09-22T15:00:00.000Z" itemprop="datePublished">2017-09-23</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/VueJS/">VueJS</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/TDD/">TDD</a>, <a class="tag-link" href="/tags/actions/">actions</a>, <a class="tag-link" href="/tags/axios/">axios</a>, <a class="tag-link" href="/tags/axios-mock-adapter/">axios-mock-adapter</a>, <a class="tag-link" href="/tags/mock/">mock</a>, <a class="tag-link" href="/tags/test/">test</a>, <a class="tag-link" href="/tags/unit/">unit</a>, <a class="tag-link" href="/tags/unit-test/">unit-test</a>, <a class="tag-link" href="/tags/vue/">vue</a>, <a class="tag-link" href="/tags/vuejs/">vuejs</a>, <a class="tag-link" href="/tags/vuex/">vuex</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>Axios를 활용해서 API 호출을 담당하는 Action들의 Unit Test에 대해 다루는 글입니다.</p>
<hr>
<a id="more"></a>
<h2 id="해보고싶다-Unit-Test"><a href="#해보고싶다-Unit-Test" class="headerlink" title="해보고싶다 Unit Test"></a>해보고싶다 Unit Test</h2><p>원칙적으로 TDD를 하고자 하면 먼저 테스트 코드를 작성 한 후에 그에 맞춰서 코드를 작성해 나가는것이라고 알고 있지만 막상 일정을 타이트하게 잡고 개발을 시작하게 되면 TDD라는 것은 까마득하게 잊어 버리게 되는것 같습니다.<br>그러나 마무리가 되어갈 쯤 TDD 해야 하나 하는 생각이 항상 스쳐지나가고 한번 해봐야지 해봐야지 하다가 매번 미루고 그냥 지나갔었던것 같습니다. 요번에 마침 여유 아닌 여유가 생겨서 TDD를 한번 시도해보았습니다.</p>
<p>이미 개발을 많이 해놓은지라 컴포넌트 단위의 이벤트를 처리하는 것을 테스트 하는 것은 시간이 많이 걸릴것 같고 API 호출을 담당하는 Action들을 조금이라도 Unit Test를 해보면 좋을것 같다는 생각이 들어서 Action Unit Test를 찾아보기 시작했습니다.<br>실제적인 Vuejs의 Unit Test에 대한 지식은 전무했던지라 하나 하나 검색해보았습니다. 처음에 생각 했을 때는 API 호출하는 기능들을 테스트하려면 DB에 뭔가 더미 데이터가 박혀 있어야 하나 생각 했었는데 이미 TDD 를 하고 계신 백엔드를 담당하시는 팀장님께서 백엔드에서는 호출 하지 않고 Mock을 만들어서 테스트를 한다고 하시더군요…<br>Mock이라는게 있는지도 몰랐었는데 <code>axios</code> 관련해서도 <code>mock</code>을 검색하니 바로 나오더 군요. <code>axios-mock-adapter</code>라는 것이었습니다. 그런데 Unit Test를 시작하지도 않았던 상태였던지라… 설명을 봐도 어떤 상황에 써야 하는것인지 감이 안오더군요… 이 모듈에 대해서는 제일 마지막에 다루게 될것 같습니다.</p>
<p>아무튼 서두가 많이 길어졌는데 TDD를 하기 위해서는 얕은 지식으로 Test코드를 먼저 구현한 다음에 실제 코딩을 하는것이라고 알고 있었는데 역시 그래야 하는것을 몸으로 부딪히며 느꼈습니다. </p>
<p><strong>지금부터 설명드리려는 과정은 하나의 Action을 테스트 해보기 위해서 기존의 코드를 수정하는 과정들까지 모두 설명드리려고 합니다.</strong></p>
<h2 id="기존-코드-수정하기"><a href="#기존-코드-수정하기" class="headerlink" title="기존 코드 수정하기"></a>기존 코드 수정하기</h2><h3 id="1-Action-분리하기"><a href="#1-Action-분리하기" class="headerlink" title="1. Action 분리하기"></a>1. Action 분리하기</h3><p><strong>제가 개발한 환경은 <code>vue-cli</code>로 기본 환경을 설정하였고 <code>store</code>폴더에 <code>vuex</code> 관련 설정을 하였었습니다.</strong><br>아래 코드와 같이 기능에 따라서 <code>module</code>들을 분리해서 구성을 했었고 하나의 <code>module</code> 안에 <code>state</code>, <code>mutations</code>, <code>actions</code>, <code>getters</code>를 모두 담은 구조로 개발해놓은 상태였었습니다.</p>
<figure class="highlight js"><figcaption><span>store/modules/project.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> state = &#123;&#125;</div><div class="line"><span class="keyword">const</span> mutations = &#123;&#125;</div><div class="line"><span class="keyword">const</span> actions = &#123;&#125;</div><div class="line"><span class="keyword">const</span> getters = &#123;&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">  state, </div><div class="line">  mutations,</div><div class="line">  actions,</div><div class="line">  getters</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>이런 형태로요 그런데…<br>Action을 Unit Test하는 방법을 찾아보니 Action들을 테스트하기 위해서는 모듈에서 별도의 파일로 분리되어 있어야 테스트 코드에서 Action들만 <code>inject-loader</code>로 삽입하여 활용하기가 용이한것을 알 수 있었습니다. 그래서 아래 구조와 같이 하나의 모듈은 한 폴더에 담고 <code>actions</code> 파일만 따로 분리하였습니다. 파일을 분리하는 방법은 각자가 사용하기 편한 스타일로 하면 될것 같습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">store</div><div class="line">└── modules</div><div class="line">   └── project</div><div class="line">       ├── index.js</div><div class="line">       └── actions.js</div></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>store/modules/project/index.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> actions <span class="keyword">from</span> <span class="string">'./actions'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> state = &#123;&#125;</div><div class="line"><span class="keyword">const</span> mutations = &#123;&#125;</div><div class="line"><span class="keyword">const</span> getters = &#123;&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">  state, </div><div class="line">  mutations,</div><div class="line">  actions,</div><div class="line">  getters</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>store/modules/project/actions.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">  <span class="comment">// 예로 Test 해볼 action 입니다.</span></div><div class="line">  setProject (&#123;commit&#125;, pid) &#123;</div><div class="line">    axios.get(<span class="string">`project/<span class="subst">$&#123;pid&#125;</span>`</span>)</div><div class="line">      .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</div><div class="line">        commit(<span class="string">'SET_PROJECT'</span>, res.data.project)</div><div class="line">      &#125;)</div><div class="line">      .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</div><div class="line">        <span class="built_in">console</span>.log(error)</div><div class="line">      &#125;)</div><div class="line">  &#125;,</div><div class="line">  <span class="comment">// 그외 action 함수들</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-API-함수화-하기"><a href="#2-API-함수화-하기" class="headerlink" title="2. API 함수화 하기"></a>2. API 함수화 하기</h3><p>여기까지는 뭐 모듈 파일들이 그리 많지 않으니 이렇게 구조 바꿔도 괜찮겠구나 생각했습니다…<br>또 그런데… 각 Action들에 심어져 있는 <code>axios</code>로 API를 호출하는 부분들을 별도로 함수화 해서 정리해주는 것이 필요했습니다.<br>이부분에서 느꼈던 것이 아직 개발 경험이 많이 없다 보니 구글에서 검색하면 나오는 자료들을 바탕으로 개발하며 일하다보니 내가 잘하고 있는 건가 하는 의문이 있었는데 그렇지 못하다는 것을 알 수 있었습니다. 그냥 봐왔던 예제들이 거의다 <code>axios.get()</code>, <code>axios.post()</code> 요런 형태들로 직접 호출하는것만 봐왔지 이부분을 분리해서 관리할 수 있겠구나 하는 생각은 해보지 못했었습니다. Action을 Unit Test하는 자료들을 보니 대부분이 API 호출 부분을 분리해서 관리할 수 있구나 하는 것을 알 수 있었습니다.<br>그래서 Action들 내의 <code>axios</code> 를 활용한 API 호출 관련 코드들을 아래와 같이 별도의 함수로 분리하였습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">api</div><div class="line">└── index.js</div><div class="line">store</div><div class="line">└── modules</div><div class="line">   └── project</div><div class="line">       ├── index.js</div><div class="line">       └── actions.js</div></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>api/index.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> getProject = <span class="function">(<span class="params">pid</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> axios.get(<span class="string">`project/<span class="subst">$&#123;pid&#125;</span>`</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>store/modules/project/actions.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> api <span class="keyword">from</span> <span class="string">'@/api'</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">  setProject (&#123;commit&#125;, pid) &#123;</div><div class="line">    api.getProject(pid) <span class="comment">// 이렇게 변경하였습니다.</span></div><div class="line">      .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</div><div class="line">        commit(<span class="string">'SET_PROJECT'</span>, res.data.project)</div><div class="line">      &#125;)</div><div class="line">      .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</div><div class="line">        <span class="built_in">console</span>.log(error)</div><div class="line">      &#125;)</div><div class="line">  &#125;,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="이제-Unit-Test를-해봅시다"><a href="#이제-Unit-Test를-해봅시다" class="headerlink" title="이제 Unit Test를 해봅시다"></a>이제 Unit Test를 해봅시다</h2><p>위에 설명드린 것과 같이 코드를 구성해놓으면 이제 하나의 Action을 Unit Test 해볼 수 있습니다. api들을 모두 함수화해 놓으면 다른 Action들도 테스트가 가능할것이구요.</p>
<p>관련문서: <a href="https://vuex.vuejs.org/kr/testing.html#" target="_blank" rel="external">Vuex Testing</a></p>
<h4 id="1-Action-helper"><a href="#1-Action-helper" class="headerlink" title="1. Action helper"></a>1. Action helper</h4><p>먼저 문서를 확인해보면 비동기 Action을 테스트하기 위해서는 helper 함수가 필요합니다. helper 함수는 대부분 Action을 사용할 때 어떤 작업을 마치고 난 이후에 Mutation으로 State에 값을 저장하는 일들을 하기 때문에 실행할 Mutation을 인자로 받아서 실제 Action처럼 동작할 수 있도록 해주는 부분 입니다. 저는 아래와 같은 구조로 구성해놓았습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">api</div><div class="line">└── index.js</div><div class="line">store</div><div class="line">└── modules</div><div class="line">   └── project</div><div class="line">       ├── index.js</div><div class="line">       └── actions.js</div><div class="line">test</div><div class="line">└── unit</div><div class="line">   ├── helpers</div><div class="line">   │   ├── index.js</div><div class="line">   │   └── api.js</div><div class="line">   └── spcecs</div><div class="line">       └── actions.spec.js</div></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>test/unit/helpers/index.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 예상되는 변이와 함께 테스팅 액션을 도와주는 헬퍼</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> testAction = <span class="function">(<span class="params">action, payload, state, expectedMutations, done</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">let</span> count = <span class="number">0</span></div><div class="line"></div><div class="line">  <span class="comment">// 모의 커밋</span></div><div class="line">  <span class="keyword">const</span> commit = <span class="function">(<span class="params">type, payload</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> mutation = expectedMutations[count]</div><div class="line"></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      expect(mutation.type).to.equal(type)</div><div class="line">      <span class="keyword">if</span> (payload) &#123;</div><div class="line">        expect(mutation.payload).to.deep.equal(payload)</div><div class="line">      &#125;</div><div class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</div><div class="line">      done(error)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    count++</div><div class="line">    <span class="keyword">if</span> (count &gt;= expectedMutations.length) &#123;</div><div class="line">      done()</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 모의 저장소와 전달인자로 액션을 부릅니다.</span></div><div class="line">  action(&#123; commit, state &#125;, payload)</div><div class="line"></div><div class="line">  <span class="comment">// 디스패치된 변이가 없는지 확인</span></div><div class="line">  <span class="keyword">if</span> (expectedMutations.length === <span class="number">0</span>) &#123;</div><div class="line">    expect(count).to.equal(<span class="number">0</span>)</div><div class="line">    done()</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="2-Mock-환경-구성하기"><a href="#2-Mock-환경-구성하기" class="headerlink" title="2. Mock 환경 구성하기"></a>2. Mock 환경 구성하기</h4><p>그리고 api 실행을 할 때 일정한 요청으로 하더라도 DB에 값이 변한다면 응답 값이 바뀔수도 있기 때문에 api 요청에 대한 일정한 응답을 할 수 있도록 Mock 환경을 구성해주어야 합니다.</p>
<p>관련문서:<a href="https://github.com/ctimmerm/axios-mock-adapter" target="_blank" rel="external">axios-mock-adapter</a></p>
<p>여기에서 아래와 같이 <code>axios-mock-adapter</code>를 활용합니다. <code>axios-mock-adapter</code> 자세한 활용 방법은 위에 링크를 확인해보시기 바랍니다.</p>
<figure class="highlight js"><figcaption><span>test/unit/helpers/api.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> MockAdapter = <span class="built_in">require</span>(<span class="string">'axios-mock-adapter'</span>)</div><div class="line"><span class="keyword">const</span> mock = <span class="keyword">new</span> MockAdapter(axios)</div><div class="line"></div><div class="line">mock.onGet(<span class="string">'project/1'</span>).reply(<span class="number">200</span>, &#123;</div><div class="line"> <span class="attr">data</span>: &#123; <span class="attr">project</span>: &#123;<span class="attr">id</span>:<span class="number">1</span>, <span class="attr">name</span>: <span class="string">'test1'</span>&#125; &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h4 id="3-진짜-막판왕-테스트-코드…"><a href="#3-진짜-막판왕-테스트-코드…" class="headerlink" title="3. 진짜 막판왕 테스트 코드…"></a>3. 진짜 막판왕 테스트 코드…</h4><p>여기까지 모든 환경구성이 완료가 되었으면 Action을 Unit Test를 하기 위한 준비가 끝났습니다.</p>
<p>이제 테스트 코드를 작성하면 됩니다.</p>
<figure class="highlight js"><figcaption><span>test/unit/specs/actions.spec.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; testAction &#125; <span class="keyword">from</span> <span class="string">'../helpers'</span></div><div class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></div><div class="line"></div><div class="line"><span class="comment">// Mock Adapter</span></div><div class="line"><span class="built_in">require</span>(<span class="string">'../helpers/api'</span>)</div><div class="line"></div><div class="line"><span class="comment">// 기존 store 소스 코드를 수정한 이유 Action만 Inject 하기 위해서...</span></div><div class="line"><span class="keyword">const</span> actionsInjector = <span class="built_in">require</span>(<span class="string">'inject-loader!@/store/modules/project/actions'</span>)</div><div class="line"></div><div class="line"><span class="comment">// axios를 함수화한 이유 axios를 사용하기 위해서...</span></div><div class="line"><span class="keyword">const</span> actions = actionsInjector(&#123;</div><div class="line">  <span class="string">'@/api'</span>: &#123;</div><div class="line">    getProject () &#123;</div><div class="line">      <span class="keyword">return</span> axios.get(<span class="string">`project/1`</span>)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">// 대망의 테스트 코드... </span></div><div class="line">describe(<span class="string">'actions'</span>, () =&gt; &#123;</div><div class="line">  it(<span class="string">'setProject'</span>, (done) =&gt; &#123;</div><div class="line">    testAction(actions.default.setProject, <span class="literal">null</span>, &#123;&#125;, [</div><div class="line">      &#123;</div><div class="line">        <span class="attr">type</span>: <span class="string">'SET_PROJECT'</span>,</div><div class="line">        <span class="attr">payload</span>: &#123;</div><div class="line">          <span class="attr">data</span>: &#123; <span class="attr">project</span>: &#123;<span class="attr">id</span>:<span class="number">1</span>, <span class="attr">name</span>: <span class="string">'test1'</span>&#125; &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    ], done)</div><div class="line">  &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>테스트 코드에서 위에 설정된 부분들을 구성하기 위해서 앞서 설명드린 환경 구성을 하였습니다.<br>그리고 테스트 코드를 작성할 때는 헬퍼 함수인 <code>testAction</code>을 활용합니다. 테스트 할 Action, Action에 전달하는 값들, State, 사용될 Mutation과 예상되는 결과 값을 인자로 넣어주면 테스트 코드가 완료 됩니다.<br>그러면 대망의 테스트 결과를 확인하실수 있을 것입니다.</p>
<p><img src="/assets/test-result.png" alt=" "></p>
<hr>
<blockquote>
<p>이 코드는 정말 간단한 코드라서 다른 좀 더 복잡한 코드들을 테스트하는 부분은 저도 앞으로 좀 더 공부해봐야 할것 같습니다. 그리고 Action 내부에서 다른 Action을 <code>dispatch</code>하는 경우를 다음 편에서 다뤄볼까 합니다.</p>
</blockquote>
<style>

video,
p img {
  width: 100%;
  box-shadow:0 10px 16px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
}

</style>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://hanwong.github.io/2017/09/23/vuex-actions-unit-test/" data-id="cj7uj1f3l000ona27ofh1mhfz" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://hanwong.github.io/2017/09/23/vuex-actions-unit-test/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://hanwong.github.io/2017/09/23/vuex-actions-unit-test/">Comments</a>
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
    
        <a href="/2017/05/20/vue-stock-trader-04/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Older</strong>
            <div class="article-nav-title">VueJS | Stock-Trader Project Tutorial (4)</div>
        </a>
    
</nav>


    
</article>


    
    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>



<div>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- git-blog2 -->
    <ins class="adsbygoogle"
        style="display:block"
        data-ad-client="ca-pub-1634774047569138"
        data-ad-slot="3851029049"
        data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div></section>
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">recent</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/09/23/vuex-actions-unit-test/" class="thumbnail">
    
    
        <span style="background-image:url(/assets/vue.png)" alt="VueJS | Vuex Unit Test (1)" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/VueJS/">VueJS</a></p>
                            <p class="item-title"><a href="/2017/09/23/vuex-actions-unit-test/" class="title">VueJS | Vuex Unit Test (1)</a></p>
                            <p class="item-date"><time datetime="2017-09-22T15:00:00.000Z" itemprop="datePublished">2017-09-23</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/05/20/vue-stock-trader-04/" class="thumbnail">
    
    
        <span style="background-image:url(/assets/vue.png)" alt="VueJS | Stock-Trader Project Tutorial (4)" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/VueJS/">VueJS</a></p>
                            <p class="item-title"><a href="/2017/05/20/vue-stock-trader-04/" class="title">VueJS | Stock-Trader Project Tutorial (4)</a></p>
                            <p class="item-date"><time datetime="2017-05-19T15:00:00.000Z" itemprop="datePublished">2017-05-20</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/05/09/vue-stock-trader-03/" class="thumbnail">
    
    
        <span style="background-image:url(/assets/vue.png)" alt="VueJS | Stock-Trader Project Tutorial (3)" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/VueJS/">VueJS</a></p>
                            <p class="item-title"><a href="/2017/05/09/vue-stock-trader-03/" class="title">VueJS | Stock-Trader Project Tutorial (3)</a></p>
                            <p class="item-date"><time datetime="2017-05-08T15:00:00.000Z" itemprop="datePublished">2017-05-09</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/05/01/vue-stock-trader-02/" class="thumbnail">
    
    
        <span style="background-image:url(/assets/vue.png)" alt="VueJS | Stock-Trader Project Tutorial (2)" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/VueJS/">VueJS</a></p>
                            <p class="item-title"><a href="/2017/05/01/vue-stock-trader-02/" class="title">VueJS | Stock-Trader Project Tutorial (2)</a></p>
                            <p class="item-date"><time datetime="2017-04-30T15:00:00.000Z" itemprop="datePublished">2017-05-01</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/04/08/elementui/" class="thumbnail">
    
    
        <span style="background-image:url(/assets/vue.png)" alt="VueJS UI Library &#39;Element&#39;" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/VueJS/">VueJS</a></p>
                            <p class="item-title"><a href="/2017/04/08/elementui/" class="title">VueJS UI Library &#39;Element&#39;</a></p>
                            <p class="item-date"><time datetime="2017-04-07T15:00:00.000Z" itemprop="datePublished">2017-04-08</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CSS/">CSS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Guide/">Guide</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/VueJS/">VueJS</a><span class="category-list-count">9</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/resource/" style="font-size: 10px;">$resource</a> <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/CodeGuide/" style="font-size: 10px;">CodeGuide</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/TDD/" style="font-size: 10px;">TDD</a> <a href="/tags/actions/" style="font-size: 10px;">actions</a> <a href="/tags/animation/" style="font-size: 10px;">animation</a> <a href="/tags/axios/" style="font-size: 10px;">axios</a> <a href="/tags/axios-mock-adapter/" style="font-size: 10px;">axios-mock-adapter</a> <a href="/tags/components/" style="font-size: 14px;">components</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/element/" style="font-size: 10px;">element</a> <a href="/tags/elementui/" style="font-size: 10px;">elementui</a> <a href="/tags/filter/" style="font-size: 10px;">filter</a> <a href="/tags/firebase/" style="font-size: 14px;">firebase</a> <a href="/tags/grid/" style="font-size: 10px;">grid</a> <a href="/tags/http/" style="font-size: 12px;">http</a> <a href="/tags/interceptors/" style="font-size: 10px;">interceptors</a> <a href="/tags/isolate-float/" style="font-size: 10px;">isolate-float</a> <a href="/tags/isolate-technique/" style="font-size: 10px;">isolate-technique</a> <a href="/tags/layout/" style="font-size: 10px;">layout</a> <a href="/tags/mock/" style="font-size: 10px;">mock</a> <a href="/tags/resource/" style="font-size: 10px;">resource</a> <a href="/tags/test/" style="font-size: 10px;">test</a> <a href="/tags/tutorial/" style="font-size: 14px;">tutorial</a> <a href="/tags/unit/" style="font-size: 10px;">unit</a> <a href="/tags/unit-test/" style="font-size: 10px;">unit-test</a> <a href="/tags/vue/" style="font-size: 20px;">vue</a> <a href="/tags/vue-resource/" style="font-size: 18px;">vue-resource</a> <a href="/tags/vue-router/" style="font-size: 14px;">vue-router</a> <a href="/tags/vuejs/" style="font-size: 20px;">vuejs</a> <a href="/tags/vuex/" style="font-size: 16px;">vuex</a>
        </div>
    </div>



<div>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- git-blog2 -->
    <ins class="adsbygoogle"
        style="display:block"
        data-ad-client="ca-pub-1634774047569138"
        data-ad-slot="3851029049"
        data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>
    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2018 Woong - 
            <span id="busuanzi_container_site_pv">
                Total visit <span id="busuanzi_value_site_pv"></span> views.
            </span>
            <br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
        
    
    <script>
    var disqus_config = function () {
        
            this.page.url = 'http://hanwong.github.io/2017/09/23/vuex-actions-unit-test/';
        
        this.page.identifier = 'vuex-actions-unit-test';
    };
    (function() { 
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'hanwong' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>